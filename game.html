<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{GAME_TITLE}} | GamePlay Jonno</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{{GAME_DESCRIPTION}}">
    <meta name="keywords" content="{{GAME_TAGS}}">
    <meta name="author" content="{{GAME_DEVELOPER}}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{GAME_TITLE}}">
    <meta property="og:description" content="{{GAME_DESCRIPTION}}">
    <meta property="og:image" content="{{GAME_THUMBNAIL}}">
    <meta property="og:url" content="{{PAGE_URL}}">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{GAME_TITLE}}">
    <meta name="twitter:description" content="{{GAME_DESCRIPTION}}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{PAGE_URL}}">
    
    <!-- Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Game Portal CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/game-page.css">
</head>
<body x-data="gamePage('dragonsweeper')">
    <!-- Top Navigation Bar -->
    <nav class="navbar-fixed">
        <div class="container-fluid">
            <div class="navbar-container">
                <!-- Left Section -->
                <div class="navbar-left">
                    <button class="sidebar-toggle" @click="toggleSidebar()" aria-label="Toggle sidebar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 17L6 12L11 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M18 17L13 12L18 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <a href="../index.html" class="navbar-brand">
                        <img src="../assets/images/logo.png" alt="GamePlay Jonno" class="navbar-logo">
                    </a>
                </div>
                
                <!-- Center Section (Desktop Only) -->
                <div class="navbar-center d-none d-lg-block">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            type="text" 
                            class="search-input" 
                            placeholder="Search games..." 
                            x-model="searchQuery"
                            @input.debounce.300ms="performSearch()"
                            @focus="showResults = true"
                            autocomplete="off"
                        >
                        <div class="search-results" :class="{ 'active': showResults && searchResults.length > 0 }">
                            <template x-for="result in searchResults" :key="result.id">
                                <a :href="'../games/' + result.id + '.html'" class="search-result-item">
                                    <div class="d-flex align-items-center">
                                        <img :src="result.thumbnail" :alt="result.title" class="me-3" style="width: 40px; height: 40px; border-radius: 8px;">
                                        <div>
                                            <div x-text="result.title" class="fw-bold"></div>
                                            <div x-text="result.category" class="text-muted small"></div>
                                        </div>
                                    </div>
                                </a>
                            </template>
                            <div class="search-loading" x-show="searchLoading">
                                <i class="fas fa-spinner fa-spin me-2"></i> Searching...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Section -->
                <div class="navbar-right">
                    <!-- Mobile Search Toggle -->
                    <button class="btn btn-link text-white d-lg-none mobile-search-toggle" @click="toggleMobileSearch()" aria-label="Toggle search">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div class="mobile-search-container" :class="{ 'active': mobileSearchOpen }">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        class="search-input" 
                        placeholder="Search games..." 
                        x-model="searchQuery"
                        @input.debounce.300ms="performSearch()"
                        @focus="showResults = true"
                        autocomplete="off"
                    >
                    <div class="search-results" :class="{ 'active': showResults && searchResults.length > 0 }">
                        <template x-for="result in searchResults" :key="result.id">
                            <a :href="'../games/' + result.id + '.html'" class="search-result-item">
                                <div class="d-flex align-items-center">
                                    <img :src="result.thumbnail" :alt="result.title" class="me-3" style="width: 40px; height: 40px; border-radius: 8px;">
                                    <div>
                                        <div x-text="result.title" class="fw-bold"></div>
                                        <div x-text="result.category" class="text-muted small"></div>
                                    </div>
                                </div>
                            </a>
                        </template>
                        <div class="search-loading" x-show="searchLoading">
                            <i class="fas fa-spinner fa-spin me-2"></i> Searching...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Sidebar Overlay (Mobile Only) -->
    <div class="sidebar-overlay" :class="{ 'active': sidebarOpen }" @click="closeSidebar()"></div>
    
    <!-- Sidebar Navigation -->
    <aside class="sidebar" :class="{ 'active': sidebarOpen }" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="navbar-brand">
                <img src="../assets/images/logo.png" alt="GamePlay Jonno" class="sidebar-logo">
            </a>
            <button class="sidebar-close d-lg-none" @click="closeSidebar()" aria-label="Close sidebar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <ul class="sidebar-nav">
                <!-- Home Link -->
                <li class="sidebar-item">
                    <a href="../index.html" class="sidebar-link">
                        <span class="sidebar-icon">
                            <i class="fas fa-home"></i>
                        </span>
                        <span class="sidebar-text">Home</span>
                    </a>
                </li>
                
                <!-- Dynamic Category Links -->
                <li class="sidebar-item">
                    <template x-for="category in categories" :key="category.id">
                        <a :href="'../categories/' + category.id + '.html'" class="sidebar-link mb-2">
                            <img :src="category.icon" :alt="category.name" class="sidebar-category-icon">
                            <span class="sidebar-text" x-text="category.name"></span>
                        </a>
                    </template>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html" class="text-decoration-none text-primary">Home</a></li>
                <li class="breadcrumb-item"><a :href="'../categories/' + currentGame.category.toLowerCase().replace(' ', '-') + '.html'" 
                   class="text-decoration-none text-primary" x-text="currentGame.category"></a></li>
                <li class="breadcrumb-item active text-white" x-text="currentGame.title"></li>
            </ol>
        </nav>
        
        <!-- Game Preview Section -->
        <div class="game-preview" id="gamePreview" 
             :style="'background-image: url(' + currentGame.thumbnail + ')'">
            <div class="preview-content">
                <img :src="currentGame.thumbnail" 
                     :alt="currentGame.title" class="game-thumbnail">
                <h1 class="game-title" id="gameTitle" x-text="currentGame.title"></h1>
                <p class="game-description" id="gameDescription" x-text="currentGame.description"></p>
                <button class="btn-3d" @click="loadGame()">
                    <i class="fas fa-play"></i> Play Now
                </button>
            </div>
        </div>
        
        <!-- Game iFrame Section -->
        <div class="game-wrapper d-none" id="gameWrapper">
            <div class="ratio ratio-16x9">
                <iframe id="gameFrame" 
                        :data-src="currentGame.iframeUrl"
                        frameborder="0" 
                        allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                </iframe>
            </div>
            
            <!-- Control Bar Section -->
            <div class="game-control-bar">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                    <button class="btn-outline-3d" @click="reloadGame()">
                        <i class="fas fa-redo"></i>
                        <span class="btn-text">Restart</span>
                    </button>
                    <button class="btn-outline-3d" id="favoriteBtn" @click="toggleFavorite()">
                        <i class="far fa-heart" :class="{ 'fas': isFavorite }"></i>
                        <span class="btn-text" x-text="isFavorite ? 'Favorited' : 'Favorite'"></span>
                    </button>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <!-- Play Time Display -->
                    <div class="play-time-display d-none" id="playTimeDisplay">
                        <i class="fas fa-clock text-primary"></i>
                        <span id="playTime">00:00</span>
                    </div>
                    <!-- Fullscreen Button Only -->
                    <div class="d-flex gap-2 screen-controls d-none" id="screenControls">
                        <button class="btn-control-3d" @click="toggleFullscreen()" title="Fullscreen">
                            <i class="fas fa-expand"></i>
                            <span class="btn-text"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Rating System -->
        <div class="rating-system">
            <h3 class="section-title">
                <i class="fas fa-star"></i> Rate This Game
            </h3>
            
            <div class="text-center mb-4">
                <p class="text-light mb-3">How would you rate <span x-text="currentGame.title"></span>?</p>
                <div class="rating-stars justify-content-center" id="ratingStars">
                    <i class="far fa-star rating-star" 
                       :class="{ 'fas': userRating >= 1 }"
                       @mouseover="highlightStars(1)"
                       @mouseout="resetStars()"
                       @click="submitRating(1)"></i>
                    <i class="far fa-star rating-star" 
                       :class="{ 'fas': userRating >= 2 }"
                       @mouseover="highlightStars(2)"
                       @mouseout="resetStars()"
                       @click="submitRating(2)"></i>
                    <i class="far fa-star rating-star" 
                       :class="{ 'fas': userRating >= 3 }"
                       @mouseover="highlightStars(3)"
                       @mouseout="resetStars()"
                       @click="submitRating(3)"></i>
                    <i class="far fa-star rating-star" 
                       :class="{ 'fas': userRating >= 4 }"
                       @mouseover="highlightStars(4)"
                       @mouseout="resetStars()"
                       @click="submitRating(4)"></i>
                    <i class="far fa-star rating-star" 
                       :class="{ 'fas': userRating >= 5 }"
                       @mouseover="highlightStars(5)"
                       @mouseout="resetStars()"
                       @click="submitRating(5)"></i>
                </div>
                <div class="text-muted mt-2">Click on a star to rate</div>
            </div>
            
            <div class="alert alert-success d-none text-center" id="ratingMessage">
                <i class="fas fa-check-circle me-2"></i>
                <span id="messageText">Thank you for your rating!</span>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-4">
                <div class="text-light">
                    <span class="fw-bold text-accent" id="averageRating" x-text="currentGame.rating.toFixed(1)"></span> average â€¢ 
                    <span id="totalRatings" x-text="formatNumber(currentGame.totalRatings)"></span> ratings
                </div>
                <button class="btn-outline-3d btn-sm" @click="resetRating()">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>
        </div>

        <!-- Social Share Bar -->
        <div class="social-share-bar">
            <div class="d-flex gap-3 flex-wrap justify-content-center">
                <span class="text-white fw-bold align-self-center">Share this game:</span>
                <a href="#" class="social-share-btn facebook" @click="shareOnFacebook()"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-share-btn twitter" @click="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-share-btn discord" @click="shareOnDiscord()"><i class="fab fa-discord"></i></a>
                <a href="#" class="social-share-btn youtube"><i class="fab fa-youtube"></i></a>
                <a href="#" class="social-share-btn tiktok"><i class="fab fa-tiktok"></i></a>
                <button class="social-share-btn share" @click="shareGame()"><i class="fas fa-share-alt"></i></button>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="game-container">
                
                <!-- Game Information Grid -->
                <div class="info-grid mt-4" id="gameInfoGrid">
                    <!-- Game Info Card -->
                    <div class="game-info-card data-loading" style="animation-delay: 0.1s">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle"></i> Game Info
                        </h3>
                         
                        <div class="sidebar-card-body">
                            <div class="info-item mb-3">
                                <div class="info-label text-uppercase mb-2 d-flex align-items-center">
                                    <i class="fas fa-folder me-2"></i>
                                    <span>Category</span>
                                </div>
                                <a :href="'../categories/' + currentGame.category.toLowerCase().replace(' ', '-') + '.html'" class="category-badge">
                                    <span x-text="currentGame.category"></span>
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                            <div class="info-item mb-3">
                                <div class="info-label text-uppercase mb-2 d-flex align-items-center">
                                    <i class="fas fa-tags me-2"></i>
                                    <span>Tags</span>
                                </div>
                                <div class="d-flex flex-wrap" id="gameTags">
                                    <template x-for="tag in currentGame.tags" :key="tag">
                                        <span class="tag-badge" x-text="tag"></span>
                                    </template>
                                </div>
                            </div>
                            <div class="info-item mb-0">
                                <div class="info-label text-uppercase mb-2 d-flex align-items-center">
                                    <i class="fas fa-clock me-2"></i>
                                    <span>Updated</span>
                                </div>
                                <div class="text-white" id="updatedDate" x-text="formatDate(currentGame.dateAdded)"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Developer Info -->
                    <div class="game-info-card data-loading" style="animation-delay: 0.2s">
                        <h3 class="section-title">
                            <i class="fas fa-users"></i> Development Team
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <div class="info-label">TEAM NAME</div>
                                <div class="text-white fw-bold" id="teamName" x-text="currentGame.teamName || currentGame.developer"></div>
                            </div>
                            <div>
                                <div class="info-label">CREATED BY</div>
                                <div class="text-white" id="createdBy" x-text="currentGame.createdBy || currentGame.developer"></div>
                            </div>
                            <div x-show="currentGame.programmedBy">
                                <div class="info-label">PROGRAMMED BY</div>
                                <div class="text-white" id="programmedBy" x-text="currentGame.programmedBy"></div>
                            </div>
                            <div x-show="currentGame.artBy">
                                <div class="info-label">ART BY</div>
                                <div class="text-white" id="artBy" x-text="currentGame.artBy"></div>
                            </div>
                            <div x-show="currentGame.musicCredits">
                                <div class="info-label">MUSIC CREDITS</div>
                                <div class="text-white" id="musicCredits" x-text="currentGame.musicCredits"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Game Details -->
                    <div class="game-info-card data-loading" style="animation-delay: 0.3s">
                        <h3 class="section-title">
                            <i class="fas fa-gamepad"></i> Game Details
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <div class="info-label">STATUS</div>
                                <div class="text-white" id="gameStatus" x-text="currentGame.gameStatus || 'Released'"></div>
                            </div>
                            <div x-show="currentGame.madeWith">
                                <div class="info-label">MADE WITH</div>
                                <div class="text-white" id="madeWith" x-text="currentGame.madeWith"></div>
                            </div>
                            <div x-show="currentGame.averageSession">
                                <div class="info-label">AVERAGE SESSION</div>
                                <div class="text-white" id="averageSession" x-text="currentGame.averageSession"></div>
                            </div>
                            <div x-show="currentGame.featuredOn">
                                <div class="info-label">FEATURED ON</div>
                                <div class="text-white" id="featuredOn" x-text="currentGame.featuredOn"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Info Sections -->
                <div class="info-grid mt-4">
                    <!-- Platforms & Inputs -->
                    <div class="info-section data-loading" style="animation-delay: 0.4s">
                        <div class="section-title">
                            <i class="fas fa-desktop"></i> Platforms & Inputs
                        </div>
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-2 text-primary">Platforms</h5>
                            <div class="d-flex flex-wrap gap-2" id="platforms">
                                <template x-for="platform in currentGame.platforms" :key="platform">
                                    <span class="tag-badge" x-text="platform"></span>
                                </template>
                            </div>
                        </div>
                        <div>
                            <h5 class="fw-semibold mb-2 text-primary">Inputs</h5>
                            <div class="d-flex flex-wrap gap-2" id="inputs">
                                <template x-for="input in currentGame.inputs" :key="input">
                                    <span class="tag-badge" x-text="input"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Languages & Accessibility -->
                    <div class="info-section data-loading" style="animation-delay: 0.5s">
                        <div class="section-title">
                            <i class="fas fa-language"></i> Languages & Accessibility
                        </div>
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-2 text-primary">Languages</h5>
                            <div class="text-light" id="languages">
                                <template x-for="language in currentGame.languages" :key="language">
                                    <div x-text="language"></div>
                                </template>
                            </div>
                        </div>
                        <div>
                            <h5 class="fw-semibold mb-2 text-primary">Accessibility</h5>
                            <div class="d-flex flex-wrap gap-2" id="accessibility">
                                <span class="tag-badge">Color-blind friendly</span>
                                <span class="tag-badge">One button mode</span>
                                <span class="tag-badge">Touch controls</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Downloads Section -->
                    <div class="info-section data-loading" style="animation-delay: 0.6s" x-show="currentGame.downloads">
                        <div class="section-title">
                            <i class="fas fa-download"></i> Downloads
                        </div>
                        
                        <div class="space-y-3" id="downloadsList">
                            <template x-for="download in currentGame.downloads" :key="download.platform">
                                <div class="download-item">
                                    <div class="flex-grow-1">
                                        <div class="fw-medium" x-text="currentGame.title + ' (' + download.platform + ')'"></div>
                                        <div class="text-muted small" x-text="download.size"></div>
                                    </div>
                                    <a :href="download.url" class="btn-outline-3d btn-sm" x-text="download.size === 'Instant Play' ? 'Play Now' : 'Download'"></a>
                                </div>
                            </template>
                        </div>
                        
                        <div class="alert alert-warning mt-3" id="installInstructions">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Install Instructions:</strong> To play on PC or mobile browser, simply click Play Now. For Android or iOS, download from your respective app store.
                        </div>
                    </div>
                </div>
                
                <!-- Devlog Section -->
                <div class="game-info-card mt-4 data-loading" style="animation-delay: 0.7s" x-show="currentGame.devlog">
                    <h3 class="section-title">
                        <i class="fas fa-newspaper"></i> Development Log
                    </h3>
                    
                    <div class="space-y-3" id="devlogList">
                        <template x-for="log in currentGame.devlog" :key="log.title">
                            <div class="devlog-item">
                                <div class="fw-bold" x-text="log.title"></div>
                                <div class="text-muted small" x-text="formatDate(log.date)"></div>
                                <div class="text-light mt-1" x-text="log.content"></div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Related Games -->
                <div class="game-info-card mt-4 data-loading" style="animation-delay: 0.8s">
                    <h3 class="section-title">
                        <i class="fas fa-gamepad"></i> Related Games
                    </h3>
                    
                    <div class="related-games-grid">
                        <template x-for="game in relatedGames" :key="game.id">
                            <a :href="'../games/' + game.id + '.html'" class="related-game-card">
                                <img :src="game.thumbnail" :alt="game.title" class="related-game-thumb">
                                <div class="related-game-info">
                                    <h4 class="related-game-title" x-text="game.title"></h4>
                                    <div class="related-game-rating">
                                        <i class="fas fa-star text-warning"></i>
                                        <span x-text="game.rating.toFixed(1)"></span>
                                    </div>
                                </div>
                            </a>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="../assets/js/app-core.js"></script>
    <script src="../assets/js/game-controller.js"></script>
    <script src="../assets/js/rating-system.js"></script>
    <script src="../games/games-data.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
